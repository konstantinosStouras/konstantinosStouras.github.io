<section class="card" id="phase1Root" style="max-width:100%;">
  <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:16px;">
    <h2 style="margin:0;border:none;padding:0;">Phase: Individual Ideation (10 min)</h2>
    <div id="timer" style="font-size:1.1rem;font-weight:600;background:#eef2ff;color:#1e40af;padding:8px 14px;border-radius:8px;">10:00</div>
  </div>

  <p id="instructionText">
    Brainstorm ideas below. Select your Top 5, then fill the submission box at the bottom with an overall idea title and description.
  </p>
</section>

<section class="card ideas-box" style="max-width:100%;">
  <h2>Your Ideas</h2>
  <input type="text" id="ideaTitle" placeholder="Idea title" />
  <textarea id="ideaDesc" placeholder="Idea description"></textarea>
  <button id="addIdea" class="btn" type="button">Add Idea</button>

  <!-- Renders like your original: <strong>title</strong><br>desc + checkbox -->
  <ul id="ideasList" style="list-style:none;padding:0;margin:12px 0 0;"></ul>

  <h2 style="margin-top:20px;">Select Top 5</h2>
  <ul id="top5List" style="list-style:none;padding:0;"></ul>

  <h2 style="margin-top:20px;">Selected Top 5 â€“ edit before finalizing</h2>
  <p class="hint">You can revise each selected idea's <strong>title</strong> and <strong>description</strong> below.</p>
  <ul id="finalEditList" style="list-style:none;padding:0;"></ul>
</section>

<section class="card submit-box" style="max-width:100%;">
  <h2>Submission Box</h2>
  <p class="hint">Provide a final overarching title and description for your Top 5 selection.</p>
  <input type="text" id="submissionTitle" placeholder="Final submission: Idea title" />
  <textarea id="submissionDesc" rows="3" placeholder="Final submission: Idea description"></textarea>
  <button id="submitAll" class="btn" data-next type="button">Submit</button>
</section>

<section class="card notes-box" style="max-width:100%;">
  <h2>Personal Notes</h2>
  <textarea id="notes" rows="5" placeholder="Write notes here (private)"></textarea>
</section>

<script>
(() => {
  // ---- Scoped helpers (avoid cross-page ID clashes in the SPA) ----
  const root = document.getElementById('phase1Root').parentElement; // current step container
  const $  = sel => root.querySelector(sel);
  const $$ = sel => Array.from(root.querySelectorAll(sel));

  // ---- Timer ----
  let time = 600;
  const timerEl = $('#timer');
  function updateTimer(){
    const m = String(Math.floor(time/60)).padStart(2,"0");
    const s = String(time%60).padStart(2,"0");
    if (timerEl) timerEl.textContent = `${m}:${s}`;
    if(time>0) time--; else clearInterval(timerInterval);
  }
  const timerInterval = setInterval(updateTimer,1000);
  updateTimer();

  // ---- State ----
  const ideas = [];            // [{id,title,desc}]
  const top5  = new Set();     // store idea ids

  // ---- Utilities ----
  function escapeHtml(str){
    if (!str) return '';
    return str.replace(/[&<>"']/g, s => ({'&':'&amp;','<':'&lt;','>':'&gt;','"':'&quot;',"'":'&#39;'}[s]));
  }

  // ---- Renderers ----
  function renderIdeas(){
    const ul = $('#ideasList');
    if (!ul) return;
    ul.innerHTML = "";
    ideas.forEach(idea => {
      const li = document.createElement("li");
      li.style.cssText = "margin:8px 0;padding:10px;border:1px solid #ddd;border-radius:6px;background:#f9fafb;";
      li.innerHTML = `
        <strong>${escapeHtml(idea.title)}</strong><br>${escapeHtml(idea.desc)}
        <div style="margin-top:8px;">
          <label style="cursor:pointer;">
            <input type="checkbox" data-top5 data-id="${idea.id}" ${top5.has(idea.id) ? "checked": ""}>
            Mark Top-5
          </label>
        </div>`;
      ul.appendChild(li);
    });
    renderTop5();
  }

  function renderTop5(){
    const chosenUl = $('#top5List');
    const editUl   = $('#finalEditList');
    if (!chosenUl || !editUl) return;

    chosenUl.innerHTML = "";
    editUl.innerHTML   = "";

    [...top5].forEach(id => {
      const idea = ideas.find(i => i.id === id);
      if (!idea) return;

      // mirror original simple list
      const li1 = document.createElement("li");
      li1.style.cssText = "margin:8px 0;padding:10px;border:1px solid #ddd;border-radius:6px;background:#f9fafb;";
      li1.innerHTML = `<strong>${escapeHtml(idea.title)}</strong><br>${escapeHtml(idea.desc)}`;
      chosenUl.appendChild(li1);

      // editable final version
      const li2 = document.createElement("li");
      li2.style.cssText = "margin:8px 0;";
      li2.innerHTML = `
        <div class="final-box" style="background:#eef2ff;border:1px solid #c7d2fe;border-radius:8px;padding:12px;">
          <label style="font-weight:600;display:block;margin:4px 0;">Idea title</label>
          <input type="text" data-final-title="${id}" value="${escapeHtml(idea.title)}" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;">
          <label style="font-weight:600;display:block;margin:8px 0 4px;">Idea description</label>
          <textarea data-final-desc="${id}" rows="3" style="width:100%;padding:8px;border:1px solid #ccc;border-radius:6px;resize:vertical;">${escapeHtml(idea.desc)}</textarea>
        </div>`;
      editUl.appendChild(li2);
    });
  }

  // ---- Events (
