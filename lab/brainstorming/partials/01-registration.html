<section class="card">
  <div style="text-align:center;padding:20px 30px 30px;margin:-22px -22px 30px;">
    <h1 style="margin:0 0 12px;font-size:32px;font-weight:800;color:#1e293b;display:flex;align-items:center;justify-content:center;gap:12px;">
      <span style="font-size:40px;">ðŸ“‹</span>
      Registration
    </h1>
    <p style="margin:0;font-size:16px;color:#64748b;">Please provide some basic information about yourself.</p>
  </div>

  <form id="regForm" novalidate>
    <div class="grid-1">
      <div>
        <label for="email">Personal E-mail</label>
        <input id="email" name="email" type="email" placeholder="Enter your personal email address" style="background:#f3f4f6;" />
        <div class="hint">We'll use this to send you study-related updates.</div>
      </div>

      <div>
        <label for="age">Age</label>
        <input id="age" name="age" type="text" placeholder="Enter your age" style="background:#f3f4f6;" />
        <div class="hint">Please enter your age in years.</div>
      </div>

      <div>
        <label for="gender">Gender</label>
        <select id="gender" name="gender" style="background:#f3f4f6; font-size:15px; padding:10px 12px;">
          <option value="">Please select...</option>
          <option value="Female">Female</option>
          <option value="Male">Male</option>
          <option value="Non-binary">Non-binary</option>
          <option value="Other">Other</option>
          <option value="Prefer not to say">Prefer not to say</option>
        </select>
        <div class="hint">Select the option that best describes you.</div>
      </div>

      <div>
        <label for="education">Education Level</label>
        <select id="education" name="education" style="background:#f3f4f6; font-size:15px; padding:10px 12px;">
          <option value="">Please select...</option>
          <option value="High School">High School</option>
          <option value="Bachelor's">Bachelor's</option>
          <option value="Master's">Master's</option>
          <option value="PhD/Doctoral">PhD/Doctoral</option>
          <option value="Other">Other</option>
        </select>
        <div class="hint">Select your highest completed education level.</div>
      </div>
    </div>

    <div class="section-header">
      <h2 style="margin:0;border:none;padding:0;">Screening Questions (Sleep and Wellness Focus)</h2>
    </div>

    <div class="grid-1" style="margin-top:16px;">
      <div>
        <label>1) How important is sleep or wellness in your daily life?</label>
        <div class="scale-buttons">
          <label class="scale-btn"><input type="radio" name="q1" value="1"><span>1</span></label>
          <label class="scale-btn"><input type="radio" name="q1" value="2"><span>2</span></label>
          <label class="scale-btn"><input type="radio" name="q1" value="3"><span>3</span></label>
          <label class="scale-btn"><input type="radio" name="q1" value="4"><span>4</span></label>
          <label class="scale-btn"><input type="radio" name="q1" value="5"><span>5</span></label>
        </div>
        <div class="hint">ðŸ’¡ 1 = Not important at all â†’ 5 = Extremely important</div>
      </div>

      <div>
        <label>2) How often do you engage in wellness-related activities?</label>
        <div class="hint" style="margin-top:-4px;margin-bottom:8px;">e.g., exercise, meditation, sleep tracking, healthy eating</div>
        <div class="radio-group">
          <label class="radio-btn"><input type="radio" name="q2" value="Daily"><span>Daily</span></label>
          <label class="radio-btn"><input type="radio" name="q2" value="Several times a week"><span>Several times a week</span></label>
          <label class="radio-btn"><input type="radio" name="q2" value="Occasionally"><span>Occasionally</span></label>
          <label class="radio-btn"><input type="radio" name="q2" value="Rarely"><span>Rarely</span></label>
          <label class="radio-btn"><input type="radio" name="q2" value="Never"><span>Never</span></label>
        </div>
      </div>

      <div>
        <label>3) Have you purchased or used any products related to sleep or wellness in the past six months?</label>
        <div class="radio-group">
          <label class="radio-btn"><input type="radio" name="q3" value="Yes"><span>Yes</span></label>
          <label class="radio-btn"><input type="radio" name="q3" value="No"><span>No</span></label>
        </div>
      </div>

      <div>
        <label>4) Would you consider yourself interested in trying new products or technologies that promote better sleep or wellness?</label>
        <div class="scale-buttons">
          <label class="scale-btn"><input type="radio" name="q4" value="1"><span>1</span></label>
          <label class="scale-btn"><input type="radio" name="q4" value="2"><span>2</span></label>
          <label class="scale-btn"><input type="radio" name="q4" value="3"><span>3</span></label>
          <label class="scale-btn"><input type="radio" name="q4" value="4"><span>4</span></label>
          <label class="scale-btn"><input type="radio" name="q4" value="5"><span>5</span></label>
        </div>
        <div class="hint">ðŸ’¡ 1 = Not interested â†’ 5 = Very interested</div>
      </div>

      <div>
        <label>5) Do you have any prior experience with innovation, marketing, or product development activities?</label>
        <div class="radio-group">
          <label class="radio-btn"><input type="radio" name="q5" value="Yes"><span>Yes</span></label>
          <label class="radio-btn"><input type="radio" name="q5" value="No"><span>No</span></label>
          <label class="radio-btn"><input type="radio" name="q5" value="Unsure"><span>Unsure</span></label>
        </div>
      </div>
    </div>

    <div class="section-header" style="margin-top:32px;">
      <h2 style="margin:0;border:none;padding:0;">Consent</h2>
    </div>

    <div class="consent-box">
      <label class="consent-item">
        <input type="checkbox" id="c1" />
        <span>I confirm that I am 18 years or older and consent to participate in this research study.</span>
      </label>
      <label class="consent-item">
        <input type="checkbox" id="c2" />
        <span>I understand that my responses will be used anonymously for research purposes only.</span>
      </label>
    </div>

    <div style="text-align:center;margin-top:24px;">
      <button id="submitBtn" class="btn" type="button">Submit and Start</button>
      <div class="foot" style="margin-top:12px;color:#6b7280;">All fields are optional (testing mode)</div>
    </div>
  </form>
</section>

<script>
(function() {
  console.log('ðŸ”„ Registration script loaded - Version 2.0');
  
  const MANDATORY_MODE = false;
  
  // Wait for DOM to be ready
  setTimeout(() => {
    const form = document.getElementById('regForm');
    const submitBtn = document.getElementById('submitBtn');
    
    if (!form || !submitBtn) {
      console.error('âŒ Form or button not found!');
      return;
    }
    
    console.log('âœ… Form elements found');
    submitBtn.disabled = false;
    
    submitBtn.addEventListener('click', (e) => {
      e.preventDefault();
      
      // Prevent double-clicks
      if (submitBtn.disabled) return;
      
      console.log('ðŸ–±ï¸ Submit button clicked');
      
      // Disable button immediately and show loading state
      submitBtn.disabled = true;
      const originalText = submitBtn.textContent;
      submitBtn.textContent = 'Submitting...';
      submitBtn.style.opacity = '0.6';
      
      // Get email and age
      const emailEl = document.getElementById('email');
      const ageEl = document.getElementById('age');
      const genderEl = document.getElementById('gender');
      const educationEl = document.getElementById('education');
      
      console.log('ðŸ“‹ Form elements:', { 
        emailEl: !!emailEl, 
        ageEl: !!ageEl,
        genderEl: !!genderEl,
        educationEl: !!educationEl
      });
      
      const email = emailEl ? emailEl.value.trim() : '';
      const age = ageEl ? ageEl.value.trim() : '';
      const gender = genderEl ? genderEl.value : '';
      const education = educationEl ? educationEl.value : '';
      
      console.log('ðŸ“ Basic form values:', { email, age, gender, education });
      
      // Get radio values with detailed logging
      const getRadioValue = (name) => {
        const radios = document.querySelectorAll(`input[name="${name}"]`);
        console.log(`  Radio group ${name}: found ${radios.length} buttons`);
        
        for (let radio of radios) {
          if (radio.checked) {
            console.log(`  âœ“ ${name} = ${radio.value}`);
            return radio.value;
          }
        }
        console.log(`  âœ— ${name} = (none selected)`);
        return '';
      };
      
      console.log('ðŸ“Š Collecting screening responses:');
      const screening = {
        q1: getRadioValue('q1'),
        q2: getRadioValue('q2'),
        q3: getRadioValue('q3'),
        q4: getRadioValue('q4'),
        q5: getRadioValue('q5')
      };
      
      console.log('âœ… Screening complete:', screening);
      
      // Check if window.__APP__ exists
      if (!window.__APP__) {
        console.error('âŒ window.__APP__ not found!');
        alert('Error: App API not available. Please reload the page.');
        submitBtn.disabled = false;
        submitBtn.textContent = originalText;
        submitBtn.style.opacity = '1';
        return;
      }
      
      const participantId = window.__APP__.getParticipantId();
      console.log('ðŸ‘¤ Participant ID:', participantId);
      
      const payload = {
        type: 'registration',
        participantId: participantId,
        email: email,
        age: age,
        gender: gender,
        education: education,
        screening: screening
      };
      
      console.log('ðŸ“¦ Final payload:', payload);
      console.log('ðŸ“¤ Sending to Google Sheets (fire-and-forget)...');
      
      // Fire-and-forget: send data but don't wait for response
      window.__APP__.logToGoogleSheets(payload).then(() => {
        console.log('âœ… Data sent successfully!');
      }).catch((error) => {
        console.error('âŒ Error sending data:', error);
      });
      
      // Store in app state
      window.__APP__.setData('registration', payload);
      
      // Move to next step immediately (don't wait for Google Sheets)
      console.log('âž¡ï¸ Moving to next step...');
      setTimeout(() => {
        window.__APP__.next();
      }, 300); // Small delay for better UX
    });
    
    console.log('âœ… Event listener attached to submit button');
  }, 100);
})();
</script>