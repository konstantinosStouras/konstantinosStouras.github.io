<style>
  .reg-header {
    text-align: center;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 2px solid var(--border);
  }
  .reg-icon {
    width: 64px;
    height: 64px;
    margin: 0 auto 16px;
    background: linear-gradient(135deg, #e0e7ff 0%, #dbeafe 100%);
    border-radius: 16px;
    display: grid;
    place-items: center;
    font-size: 32px;
    box-shadow: 0 4px 12px rgba(37, 99, 235, 0.15);
  }
  .reg-title {
    font-size: 28px;
    font-weight: 800;
    color: var(--ink);
    margin: 0 0 8px;
  }
  .reg-subtitle {
    color: var(--muted);
    font-size: 15px;
  }
  
  .form-section {
    margin-bottom: 32px;
  }
  .section-header {
    display: flex;
    align-items: center;
    gap: 12px;
    margin-bottom: 20px;
    padding-bottom: 12px;
    border-bottom: 2px solid var(--border);
  }
  .section-icon {
    width: 32px;
    height: 32px;
    background: var(--brand);
    color: white;
    border-radius: 8px;
    display: grid;
    place-items: center;
    font-size: 18px;
    flex-shrink: 0;
  }
  .section-title {
    font-size: 18px;
    font-weight: 700;
    color: var(--ink);
    margin: 0;
  }
  
  .field-group {
    margin-bottom: 20px;
  }
  .field-group label {
    display: block;
    font-weight: 600;
    font-size: 14px;
    margin-bottom: 8px;
    color: var(--ink);
  }
  .field-group input,
  .field-group select,
  .field-group textarea {
    transition: all 0.2s ease;
    font-size: 15px;
  }
  .field-group input:focus,
  .field-group select:focus,
  .field-group textarea:focus {
    outline: none;
    border-color: var(--brand);
    box-shadow: 0 0 0 3px rgba(37, 99, 235, 0.1);
  }
  
  .scale-group {
    display: flex;
    gap: 8px;
    align-items: center;
    flex-wrap: wrap;
    padding: 16px;
    border: 2px solid var(--border);
    border-radius: 12px;
    background: linear-gradient(to bottom, #ffffff, #f9fafb);
  }
  .scale-option {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 6px;
  }
  .scale-option input[type="radio"] {
    appearance: none;
    width: 40px;
    height: 40px;
    border: 2px solid var(--border);
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s ease;
    display: grid;
    place-items: center;
    background: white;
    font-weight: 600;
    color: var(--muted);
  }
  .scale-option input[type="radio"]:checked {
    background: var(--brand);
    border-color: var(--brand);
    color: white;
    transform: scale(1.05);
  }
  .scale-option input[type="radio"]:hover:not(:checked) {
    border-color: var(--brand);
    background: #f0f5ff;
  }
  .scale-option input[type="radio"]::after {
    content: attr(value);
  }
  .scale-label {
    font-size: 11px;
    color: var(--muted);
    font-weight: 500;
  }
  
  .radio-group {
    display: flex;
    gap: 10px;
    flex-wrap: wrap;
  }
  .radio-option {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 10px 16px;
    border-radius: 10px;
    background: #f8fafc;
    border: 2px solid var(--border);
    cursor: pointer;
    transition: all 0.2s ease;
    font-size: 14px;
  }
  .radio-option:has(input:checked) {
    background: #e0e7ff;
    border-color: var(--brand);
    font-weight: 600;
  }
  .radio-option input[type="radio"] {
    width: 18px;
    height: 18px;
    margin: 0;
  }
  
  .hint-text {
    color: var(--muted);
    font-size: 13px;
    margin-top: 6px;
    display: flex;
    align-items: center;
    gap: 6px;
  }
  .hint-text::before {
    content: "üí°";
    font-size: 14px;
  }
  
  .error-message {
    color: #dc2626;
    font-size: 13px;
    margin-top: 6px;
    display: none;
    align-items: center;
    gap: 6px;
    font-weight: 500;
  }
  .error-message::before {
    content: "‚ö†Ô∏è";
  }
  
  .consent-box {
    background: linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%);
    border: 2px solid #bae6fd;
    border-radius: 12px;
    padding: 20px;
    margin-top: 24px;
  }
  .consent-item {
    display: flex;
    align-items: flex-start;
    gap: 12px;
    margin-bottom: 12px;
  }
  .consent-item:last-child {
    margin-bottom: 0;
  }
  .consent-item input[type="checkbox"] {
    width: 20px;
    height: 20px;
    margin-top: 2px;
    cursor: pointer;
    flex-shrink: 0;
  }
  .consent-item label {
    cursor: pointer;
    font-size: 14px;
    line-height: 1.5;
  }
  
  .submit-area {
    margin-top: 32px;
    padding-top: 24px;
    border-top: 2px solid var(--border);
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
  }
  .submit-btn {
    background: linear-gradient(135deg, var(--brand), var(--brand-dark));
    color: white;
    border: none;
    border-radius: 12px;
    padding: 14px 32px;
    font-size: 16px;
    font-weight: 700;
    cursor: pointer;
    box-shadow: 0 4px 14px rgba(37, 99, 235, 0.3);
    transition: all 0.2s ease;
    min-width: 200px;
  }
  .submit-btn:hover:not(:disabled) {
    transform: translateY(-2px);
    box-shadow: 0 6px 20px rgba(37, 99, 235, 0.4);
  }
  .submit-btn:disabled {
    background: #d1d5db;
    box-shadow: none;
    cursor: not-allowed;
  }
  .required-note {
    color: var(--muted);
    font-size: 13px;
  }
</style>

<section class="card">
  <div class="reg-header">
    <div class="reg-icon">üìã</div>
    <h1 class="reg-title">Registration</h1>
    <p class="reg-subtitle">Please provide some basic information about yourself.</p>
  </div>

  <form id="regForm" novalidate>
    <!-- Personal Information Section -->
    <div class="form-section">
      <div class="section-header">
        <div class="section-icon">üë§</div>
        <h2 class="section-title">Personal Information</h2>
      </div>

      <div class="grid">
        <div class="field-group">
          <label for="fullName">Full Name *</label>
          <input id="fullName" name="fullName" type="text" placeholder="Enter your full name" required />
          <div class="error-message" data-err="fullName">Full name is required.</div>
        </div>

        <div class="field-group">
          <label for="email">Email Address *</label>
          <input id="email" name="email" type="email" placeholder="you@example.com" required />
          <div class="error-message" data-err="email">Valid email is required.</div>
        </div>

        <div class="field-group">
          <label for="age">Age *</label>
          <select id="age" name="age" required>
            <option value="">Select your age range</option>
            <option>18‚Äì24</option>
            <option>25‚Äì34</option>
            <option>35‚Äì44</option>
            <option>45‚Äì54</option>
            <option>55+</option>
          </select>
          <div class="error-message" data-err="age">Please select your age range.</div>
        </div>

        <div class="field-group">
          <label for="gender">Gender (optional)</label>
          <select id="gender" name="gender">
            <option>Prefer not to say</option>
            <option>Female</option>
            <option>Male</option>
            <option>Non-binary</option>
            <option>Other</option>
          </select>
        </div>

        <div class="field-group">
          <label for="nationality">Nationality *</label>
          <input id="nationality" name="nationality" type="text" placeholder="Enter your nationality" required />
          <div class="error-message" data-err="nationality">Please enter your nationality.</div>
        </div>

        <div class="field-group">
          <label for="country">Country of Residence *</label>
          <input id="country" name="country" type="text" placeholder="Enter your country" required />
          <div class="error-message" data-err="country">Please enter your country of residence.</div>
        </div>

        <div class="field-group">
          <label for="occupation">Occupation *</label>
          <select id="occupation" name="occupation" required>
            <option value="">Select your occupation</option>
            <option>Student</option>
            <option>Employed full-time</option>
            <option>Employed part-time</option>
            <option>Self-employed</option>
            <option>Unemployed</option>
            <option>Other (please specify)</option>
          </select>
          <div class="error-message" data-err="occupation">Please select your occupation.</div>
        </div>

        <div class="field-group hidden" id="occupationOtherWrap">
          <label for="occupationOther">Occupation ‚Äì Other</label>
          <input id="occupationOther" name="occupationOther" type="text" placeholder="Please specify" />
        </div>

        <div class="field-group">
          <label for="study">Level of Study (if applicable)</label>
          <select id="study" name="study">
            <option>Not currently studying</option>
            <option>Undergraduate</option>
            <option>Master's</option>
            <option>Doctoral (PhD)</option>
            <option>Other (please specify)</option>
          </select>
        </div>

        <div class="field-group hidden" id="studyOtherWrap">
          <label for="studyOther">Level of Study ‚Äì Other</label>
          <input id="studyOther" name="studyOther" type="text" placeholder="Please specify" />
        </div>

        <div class="field-group">
          <label for="fluency">English Fluency *</label>
          <select id="fluency" name="fluency" required>
            <option value="">Select your fluency level</option>
            <option>Native</option>
            <option>Fluent</option>
            <option>Intermediate</option>
            <option>Basic</option>
          </select>
          <div class="error-message" data-err="fluency">Please select your English fluency.</div>
        </div>
      </div>
    </div>

    <!-- Screening Questions Section -->
    <div class="form-section">
      <div class="section-header">
        <div class="section-icon">‚ùì</div>
        <h2 class="section-title">Screening Questions (Sleep and Wellness Focus)</h2>
      </div>

      <div class="field-group">
        <label>1) How important is sleep or wellness in your daily life?</label>
        <div class="scale-group">
          <div class="scale-option">
            <input type="radio" name="q1" value="1" required>
          </div>
          <div class="scale-option">
            <input type="radio" name="q1" value="2">
          </div>
          <div class="scale-option">
            <input type="radio" name="q1" value="3">
          </div>
          <div class="scale-option">
            <input type="radio" name="q1" value="4">
          </div>
          <div class="scale-option">
            <input type="radio" name="q1" value="5">
          </div>
        </div>
        <div class="hint-text">1 = Not important at all ‚Üí 5 = Extremely important</div>
        <div class="error-message" data-err="q1">Please select a value.</div>
      </div>

      <div class="field-group">
        <label>2) How often do you engage in wellness-related activities?</label>
        <p style="font-size: 13px; color: var(--muted); margin: 4px 0 12px;">e.g., exercise, meditation, sleep tracking, healthy eating</p>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="q2" value="Daily" required>
            <span>Daily</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q2" value="Several times a week">
            <span>Several times a week</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q2" value="Occasionally">
            <span>Occasionally</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q2" value="Rarely">
            <span>Rarely</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q2" value="Never">
            <span>Never</span>
          </label>
        </div>
        <div class="error-message" data-err="q2">Please choose one option.</div>
      </div>

      <div class="field-group">
        <label>3) Have you purchased or used any products related to sleep or wellness in the past six months?</label>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="q3" value="Yes" required>
            <span>Yes</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q3" value="No">
            <span>No</span>
          </label>
        </div>
        <div id="q3specWrap" class="hidden" style="margin-top:14px;">
          <label for="q3spec">If yes, please specify briefly</label>
          <textarea id="q3spec" name="q3spec" placeholder="e.g., sleep tracker, meditation app, weighted blanket" style="margin-top: 8px;"></textarea>
        </div>
        <div class="error-message" data-err="q3">Please choose Yes or No.</div>
      </div>

      <div class="field-group">
        <label>4) Would you consider yourself interested in trying new products or technologies that promote better sleep or wellness?</label>
        <div class="scale-group">
          <div class="scale-option">
            <input type="radio" name="q4" value="1" required>
          </div>
          <div class="scale-option">
            <input type="radio" name="q4" value="2">
          </div>
          <div class="scale-option">
            <input type="radio" name="q4" value="3">
          </div>
          <div class="scale-option">
            <input type="radio" name="q4" value="4">
          </div>
          <div class="scale-option">
            <input type="radio" name="q4" value="5">
          </div>
        </div>
        <div class="hint-text">1 = Not interested ‚Üí 5 = Very interested</div>
        <div class="error-message" data-err="q4">Please select a value.</div>
      </div>

      <div class="field-group">
        <label>5) Do you have any prior experience with innovation, marketing, or product development activities?</label>
        <div class="radio-group">
          <label class="radio-option">
            <input type="radio" name="q5" value="Yes" required>
            <span>Yes</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q5" value="No">
            <span>No</span>
          </label>
          <label class="radio-option">
            <input type="radio" name="q5" value="Unsure">
            <span>Unsure</span>
          </label>
        </div>
        <div class="error-message" data-err="q5">Please choose one option.</div>
      </div>
    </div>

    <!-- Consent Section -->
    <div class="form-section">
      <div class="section-header">
        <div class="section-icon">‚úì</div>
        <h2 class="section-title">Consent</h2>
      </div>
      
      <div class="consent-box">
        <div class="consent-item">
          <input type="checkbox" id="c1" required>
          <label for="c1">I confirm that I am 18 years or older and consent to participate in this research study.</label>
        </div>
        <div class="consent-item">
          <input type="checkbox" id="c2" required>
          <label for="c2">I understand that my responses will be used anonymously for research purposes only.</label>
        </div>
      </div>
    </div>

    <div class="submit-area">
      <button id="submitBtn" class="submit-btn" type="button">Submit and Start</button>
      <span class="required-note">* Required fields</span>
    </div>
  </form>
</section>

<script>
  const MANDATORY_MODE = false;
  const form = document.getElementById('regForm');
  const submitBtn = document.getElementById('submitBtn');
  const occupation = document.getElementById('occupation');
  const occupationOtherWrap = document.getElementById('occupationOtherWrap');
  const study = document.getElementById('study');
  const studyOtherWrap = document.getElementById('studyOtherWrap');
  const q3specWrap = document.getElementById('q3specWrap');
  const c1 = document.getElementById('c1');
  const c2 = document.getElementById('c2');

  occupation.addEventListener('change', () => {
    occupationOtherWrap.classList.toggle('hidden', occupation.value !== 'Other (please specify)');
  });
  study.addEventListener('change', () => {
    studyOtherWrap.classList.toggle('hidden', study.value !== 'Other (please specify)');
  });
  document.querySelectorAll('input[name="q3"]').forEach(r=>{
    r.addEventListener('change', () => {
      q3specWrap.classList.toggle('hidden', r.value !== 'Yes');
    });
  });

  function toggleSubmit(){
    if (!MANDATORY_MODE) { submitBtn.disabled = false; return; }
    submitBtn.disabled = !(c1.checked && c2.checked);
  }
  c1.addEventListener('change', toggleSubmit);
  c2.addEventListener('change', toggleSubmit);
  toggleSubmit();

  function showError(id, show){
    const el = document.querySelector(`[data-err="${id}"]`);
    if (el) el.style.display = show ? 'flex' : 'none';
  }

  submitBtn.addEventListener('click', () => {
    if (!MANDATORY_MODE) {
      if (window.__APP__) window.__APP__.next();
      return;
    }

    let ok = true;
    const requiredIds = ['fullName','email','age','nationality','country','occupation','fluency'];
    requiredIds.forEach(id => {
      const el = document.getElementById(id);
      const valid = el && el.value && (el.type !== 'email' || /\S+@\S+\.\S+/.test(el.value));
      showError(id, !valid);
      if (!valid) ok = false;
    });

    ['q1','q2','q3','q4','q5'].forEach(name=>{
      const any = [...document.querySelectorAll(`input[name="${name}"]`)].some(r=>r.checked);
      showError(name, !any);
      if (!any) ok = false;
    });

    if (!(c1.checked && c2.checked)) ok = false;

    if (!ok) {
      window.scrollTo({ top: 0, behavior: 'smooth' });
      return;
    }

    const data = new FormData(form);
    const payload = Object.fromEntries(data.entries());
    console.log('Registration payload:', payload);

    if (window.__APP__) window.__APP__.next();
  });
</script>